[pytest]
pythonpath = alphaforge-brain/src
addopts = -q --maxfail=1 --durations=25 --cov=alphaforge-brain/src --cov-report=term-missing --cov-report=xml --cov-fail-under=29
# Coverage ratchet: initial threshold set to 29% (current ~29.7%).
# Raise incrementally (next target 32–35%) after adding more service & negative path tests.
# Historical context: earlier guidance recommended starting at 30%; we are just below 30 so starting at 29 to avoid immediate failure.
# Limit test discovery to migrated tests
testpaths = alphaforge-brain/tests
# Register custom markers
markers =
	integration: marks tests as integration (deselect with '-m "not integration"')
	unit: fast unit tests (logic-level, no I/O)
	perf: performance or benchmark tests (may be slow)
	stress: stress or sweep tests across variants
	timeout: tests with an enforced wall-clock timeout
	memory: memory ceiling or RSS-related tests
	determinism: replay or hashing determinism tests
	sdk: tests that exercise the client SDK (Mind)
	feature006: backend Feature 006 test-first group (T060–T066 scaffolding)
	artifacts: artifact retrieval / format handling tests
	retention: retention policy and demotion tests
# Updated for dual-root migration; legacy src/tests retained temporarily until removal.

# Asyncio plugin config (pytest-asyncio managed via deps; safe to enable)
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
